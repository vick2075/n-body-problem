au = 149597870700.;
day = 3600. * 24.;
G1 = 6.67430e-11;
G = G1/au^3*(day)^2;


bod = ["Sun"; ...
    'Mer';'Ven';'Ear';'Mar';'Jup';'Sat';'Ura';'Nep'; ...
    'Plu';'Haum';'Make';'Sedn';'Eris'; ...
    'Ceres';'Pallas';'Eros';'Vesta';'Apoph';'Touta';'Itoka';'Gasp';'Ida';'Iris';'Hygie'; ...
    'Hal';'Ha-Bo'];

mass = [1.98847e+30; ...
    3.3011e+23; 4.8675e+24; 5.9722e+24; 6.4171e+23; 1.89813e+27; 5.6834e+26; 8.6810e+25; 1.0243e+26; ...
    1.303e+22; 4.006e+21; 3.1e+21; 2.0e+21; 1.6466e+22; ...
    9.3835e+20; 2.04e+20; 6.687e+15; 2.59076e+20; 6.1e+10; 5.0e+13; 3.5e+10; 2.5e+16; 1.0e+17; 13.75e+18; 85.3e+18; ...
    2.2e+14; 1.3e+16];

[N, c] = size(bod);

function out = fu(G, pos, mass)
xx = pos(:,1);
yy = pos(:,2);
zz = pos(:,3);

dx = xx' - xx;
dy = yy' - yy;
dz = zz' - zz;

inv_r3 = (dx.^2 + dy.^2 + dz.^2).^(-1.5);
inv_r3(isinf(inv_r3)) = 0;

ax = G * (dx .* inv_r3) * mass;
ay = G * (dy .* inv_r3) * mass;
az = G * (dz .* inv_r3) * mass;

out = [ax ay az];
end




data = pyrunfile('astro.py','pos');
data2 = pyrunfile('astro.py','vel');
pos = double(data);
vel = double(data2);

%{
pos = [[ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00];
       [-2.74630371e-01,  2.00362207e-01,  4.15640302e-02];
       [-7.15242414e-01, -7.65767928e-02,  4.02184089e-02];
       [-1.65851246e-01,  9.69230782e-01, -5.49152447e-05];
       [-2.93358284e-01, -1.45112310e+00, -2.32156198e-02];
       [ 3.49317043e+00,  3.55504313e+00, -9.29206599e-02];
       [ 8.99607218e+00, -3.71615863e+00, -2.93404083e-01];
       [ 1.22709921e+01,  1.53002942e+01, -1.02265208e-01];
       [ 2.98429826e+01, -1.79090673e+00, -6.50850419e-01];
       [ 1.72099734e+01, -3.03386439e+01, -1.72933652e+00];
       [-3.80093237e+01, -2.23145746e+01,  2.36336615e+01];
       [-4.60977773e+01, -7.48346144e+00,  2.43655822e+01];
       [ 4.12105250e+01,  7.06179299e+01, -1.71966892e+01];
       [ 8.55557773e+01,  3.88304313e+01, -1.81833574e+01];
       [-1.09591255e+00, -2.53043421e+00,  1.21818088e-01];
       [-2.13703987e+00, -1.16252989e+00,  9.89510675e-01];
       [ 1.32410731e+00,  5.25501167e-01,  2.65860328e-01];
       [-7.29575409e-02,  2.56128766e+00, -6.71686669e-02];
       [-7.96513787e-01, -5.52877794e-01,  1.06092740e-02];
       [-9.60390801e-01, -3.23058722e+00,  2.07451138e-02];
       [-1.04948275e+00,  4.21970418e-01,  3.20100291e-02];
       [-1.91201736e+00, -1.70637891e+00, -9.54107833e-02];
       [ 1.54574080e+00, -2.51146154e+00, -2.17671257e-02];
       [-3.17232210e-01, -2.73830098e+00,  1.80890185e-02];
       [ 3.05584576e+00, -9.51488757e-01,  1.84763041e-01];
       [-1.98375418e+01,  2.72486792e+01, -9.95188534e+00];
       [ 4.08377890e+00, -2.05134952e+01, -4.31712606e+01]];


vel = [[ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00];
       [-2.23265341e-02, -2.15650139e-02,  2.85565076e-04];
       [ 2.02919311e-03, -2.02012291e-02, -3.94518250e-04];
       [-1.72348874e-02, -2.96066421e-03,  6.83947075e-07];
       [ 1.42434475e-02, -1.57217905e-03, -3.82326545e-04];
       [-5.47584575e-03,  5.64954447e-03,  9.90076406e-05];
       [ 1.81713875e-03,  5.15052756e-03, -1.61677856e-04];
       [-3.10249045e-03,  2.28383907e-03,  4.86500668e-05];
       [ 1.62778566e-04,  3.15915587e-03, -6.87292764e-05];
       [ 2.79791168e-03,  8.56243907e-04, -9.06032893e-04];
       [ 1.31858393e-03, -1.78540290e-03, -9.35769172e-05];
       [ 1.21812584e-04, -2.14641471e-03, -2.87743769e-04];
       [-2.46981740e-03,  6.34881385e-04,  1.95318670e-04];
       [-4.54833136e-04,  8.74410266e-04,  9.32904844e-04];
       [ 8.97377839e-03, -4.86619939e-03, -1.80711631e-03];
       [ 4.13084517e-03, -8.44271631e-03,  5.49431164e-03];
       [-8.16473192e-03,  1.17812116e-02, -2.11130234e-05];
       [-1.01836409e-02, -5.38179578e-04,  1.25591629e-03];
       [ 1.21139215e-02, -1.19191821e-02,  9.22547186e-04];
       [ 7.33050860e-03,  2.35241733e-03, -5.74089611e-05];
       [-2.37566294e-03, -1.71425722e-02, -1.10471390e-04];
       [ 6.99945502e-03, -6.89236955e-03,  6.25187493e-04];
       [ 8.22720956e-03,  5.43200715e-03,  1.82556210e-04];
       [ 9.46552545e-03,  5.55077902e-04,  8.89519974e-04];
       [ 3.77728785e-03,  8.71501194e-03,  3.79336869e-04];
       [ 4.14006019e-04,  3.17531214e-04,  6.33594995e-05];
       [ 3.67255952e-04, -1.80274195e-03, -2.69940837e-03]];
%}

currentTime = 0;
dt = 1.0;
tf = 17665;
nn = ceil(tf/dt);

acceleration = fu(G, pos, mass);


savedPositions = zeros(N, 3, nn + 1);
savedPositions(:, :, 1) = pos;



for i = 1:nn
    
    % (1/2) Kick
    vel = vel + acceleration * dt / 2;
    
    % Drift
    pos = pos + vel * dt;
    
    % Update accelerations
    acceleration = fu(G, pos, mass);
    
    % (1/2) Kick
    vel = vel + acceleration * dt / 2;
    
    % Update time
    currentTime = currentTime + dt;
    
    % Save energies, positions for plotting trail
    savedPositions(:, :, i + 1) = pos;
    
end



xx = savedPositions(:,1,:);
yy = savedPositions(:,2,:);
zz = savedPositions(:,3,:);

fig = figure( ...
    'name', 'n-body');

s = 100;
%axis([-s s -s s -s s])
ax = axes( ...
    'xlim', [-s,s],   'ylim', [-s,s],   'zlim', [-s,s], ...
    'xgrid', 'on',    'ygrid', 'on',    'zgrid', 'on');


xlabel('X');
ylabel('Y');
zlabel('Z');

color = hsv(N);

for i = 1:N
    planets(i) = line(xx(i,:),yy(i,:),zz(i,:), ...
        'color',color(i,:), 'marker','.','markersize',8);
    planets(i) = line(xx(i,end),yy(i,end),zz(i,end), ...
        'color',color(i,:), 'marker','o', 'markersize', 8,'MarkerFaceColor',color(i,:));
    planets(i) = text(xx(i,end),yy(i,end),zz(i,end), bod(i), ...
        'HorizontalAlignment','left','FontSize',8,'Color','b');
    
end


for i = 1:N
    view(90,90)                                
    planets = plotUpdate(planets,savedPositions(i,:,:));                                      
     
end

function planets = plotUpdate(planets,x)
[N,c,c1] = size(x);
    for e = 1:N
        set(planets(e), ...
            'XData',x(e,1), ...
            'YData',x(e,2), ...
            'ZData',x(e,3));
    end
end

